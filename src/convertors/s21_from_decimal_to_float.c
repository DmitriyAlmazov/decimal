#include "./../s21_decimal.h"
#include <math.h>

// Улучшенная версия функции s21_from_decimal_to_float
int s21_from_decimal_to_float(s21_decimal src, float* dst) {
  int res = 1; // Инициализируем результат как неуспешный (1 означает ошибку)
  
  if (dst) { // Проверяем, что указатель на float не является нулевым
    double tmp = 0.0; // Временная переменная для накопления значения в формате double
    int exp = getScale(src); // Получаем масштаб (количество десятичных знаков) из src

    // Вычисляем значение из битов
    for (int i = 0; i < 96; i++) { // Проходим по всем 96 значимым битам числа
      if (getBit(src, i)) { // Проверяем, установлен ли i-й бит в src
        tmp += pow(2.0, i); // Если бит установлен, добавляем соответствующую степень двойки к tmp
      }
    }

    // Применяем масштаб
    while (exp > 0) { // Пока есть десятичные знаки, которые нужно учесть
      tmp /= 10.0; // Делим tmp на 10, чтобы учесть один десятичный знак
      exp--; // Уменьшаем количество оставшихся десятичных знаков
    }

    // Применяем знак
    if (getSign(src)) { // Проверяем знак числа в src
      tmp = -tmp; // Если число отрицательное, меняем знак tmp на отрицательный
    }

    *dst = (float)tmp; // Преобразуем tmp в float и записываем результат по указателю dst

    res = 0; // Успешное выполнение: устанавливаем res в 0
  }
  
  return res; // Возвращаем результат выполнения (0 для успеха, 1 для ошибки)
}