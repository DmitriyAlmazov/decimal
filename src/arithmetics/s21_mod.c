#include "./../s21_decimal.h"
#include <string.h>

// Функция для вычисления остатка от деления (mod)
int s21_mod(s21_decimal value_1, s21_decimal value_2, s21_decimal* result) {
    // Инициализация результата, устанавливая все биты в ноль
    // Это необходимо, чтобы очистить предыдущие данные в result
    memset(result->bits, 0, sizeof(result->bits));

    int status = 0; // Переменная для хранения статуса выполнения функции

    // Проверка на равенство двух чисел
    if (s21_is_equal(value_1, value_2)) {
        // Если числа равны, остаток от деления равен 0
        // Инициализация результата в ноль (уже сделана выше, но для ясности)
        memset(result->bits, 0, sizeof(result->bits));
        status = 0; // Успешное выполнение
    } 
    // Если первое число меньше второго и оба числа не равны нулю
    else if (s21_is_less(value_1, value_2) && !isNull(value_1) && !isNull(value_2)) {
        // В этом случае остаток равен первому числу
        *result = value_1; // Устанавливаем результат равным первому числу
        status = 0; // Успешное выполнение
    } 
    // Для остальных случаев (когда value_1 больше value_2)
    else {
        s21_decimal division_result = {0}; // Переменная для хранения результата деления
        s21_decimal truncated_result = {0}; // Переменная для хранения усеченного результата деления

        // Убираем знаки перед выполнением операций, чтобы результат был положительным
        setSign(&value_1, 0);
        setSign(&value_2, 0);

        // Выполняем деление и сохраняем результат в division_result
        status = s21_div(value_1, value_2, &division_result);

        if (status == 0) { // Проверяем, успешно ли выполнено деление
            // Усечение результата деления (игнорирование дробной части)
            s21_truncate(division_result, &truncated_result);

            // Умножаем усеченный результат на делитель
            s21_decimal multiplied_result = {0}; // Переменная для хранения результата умножения
            s21_mul(truncated_result, value_2, &multiplied_result);

            // Вычисляем остаток от деления как разницу между первым числом и произведением
            s21_sub(value_1, multiplied_result, result);
        }
    }

    return status; // Возвращаем статус выполнения функции (0 для успешного завершения)
}
